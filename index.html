<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlay Chat Candy 2.5D - felipecanneli</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Fredoka:wght@700&display=swap');

        :root {
            --nick-orange: #FF5C00;
            --slime-green: #CCFF00;
            --candy-pink: #FF00FF;
            --electric-blue: #00E5FF;
            --white: #FFFFFF;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: transparent !important;
            width: 100vw;
            height: 100vh;
        }

        #chat-container {
            position: absolute;
            bottom: 60px;
            left: 60px;
            display: flex;
            flex-direction: column-reverse; /* Novas mensagens em baixo */
            gap: 40px;
            perspective: 1000px;
        }

        .message-wrapper {
            position: relative;
            animation: entrance 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            filter: drop-shadow(10px 10px 0px rgba(0,0,0,0.15));
        }

        @keyframes entrance {
            0% { transform: translateX(-200px) rotateY(-30deg) scale(0.5); opacity: 0; }
            100% { transform: translateX(0) rotateY(0) scale(1); opacity: 1; }
        }

        /* O Bloco Candy */
        .message-block {
            position: relative;
            width: 400px;
            background: var(--nick-orange);
            border: 12px solid var(--white);
            border-radius: 40px;
            padding: 20px 25px;
            box-sizing: border-box;
            box-shadow: 
                inset -8px -8px 0px rgba(0,0,0,0.2),
                inset 8px 8px 0px rgba(255,255,255,0.4);
            overflow: visible;
            /* Efeito Glossy */
            background-image: linear-gradient(135deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 50%);
            z-index: 2;
        }

        /* Brilho Neon na Borda */
        .message-block::before {
            content: '';
            position: absolute;
            top: -15px; left: -15px; right: -15px; bottom: -15px;
            border-radius: 50px;
            border: 2px solid var(--white);
            box-shadow: 0 0 20px var(--white), inset 0 0 10px var(--white);
            opacity: 0.6;
            pointer-events: none;
        }

        .username {
            font-family: 'Luckiest Guy', cursive;
            font-size: 32px;
            color: var(--slime-green);
            text-transform: uppercase;
            -webkit-text-stroke: 8px black;
            paint-order: stroke fill;
            margin-bottom: 5px;
            display: block;
            filter: drop-shadow(0 0 10px var(--slime-green));
        }

        .text {
            font-family: 'Fredoka', sans-serif;
            font-size: 28px;
            color: var(--white);
            line-height: 1.2;
            -webkit-text-stroke: 6px black;
            paint-order: stroke fill;
            word-wrap: break-word;
        }

        /* Slime SVG Container */
        .slime-container {
            position: absolute;
            bottom: -50px;
            left: 20px;
            width: 360px;
            height: 150px;
            pointer-events: none;
            z-index: 1;
        }

        .slime-svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 8px var(--slime-green));
        }

        .slime-drop {
            fill: var(--slime-green);
            animation: drip 3s infinite ease-in-out;
            transform-origin: top center;
        }

        @keyframes drip {
            0%, 100% { transform: scaleY(1) translateY(0); }
            50% { transform: scaleY(2.5) translateY(5px); }
        }

        /* Efeito de balanço de gelatina no bloco todo */
        .wobble {
            animation: jelly 4s infinite ease-in-out;
        }

        @keyframes jelly {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(1deg) scale(1.02); }
            75% { transform: rotate(-1deg) scale(0.98); }
        }
    </style>
</head>
<body>
    <div id="chat-container"></div>

    <!-- Filtro para efeito de gosma (Metaballs) no Slime -->
    <svg style="display:none;">
        <defs>
            <filter id="goo">
                <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blur" />
                <feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7" result="goo" />
            </filter>
        </defs>
    </svg>

    <script src="https://cdn.jsdelivr.net/npm/tmi.js@1.8.5/dist/tmi.min.js"></script>
    <script>
        const TWITCH_CHANNEL = 'felipecanneli';
        const chatContainer = document.getElementById('chat-container');
        const MAX_MESSAGES = 4;

        function createSlimeSVG() {
            // Cria um SVG de slime dinâmico com gotas variadas
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute("class", "slime-svg");
            svg.style.filter = "url(#goo)"; // Aplica o efeito de fusão/gosma

            for (let i = 0; i < 6; i++) {
                const circle = document.createElementNS(svgNS, "circle");
                const x = 50 + (i * 60);
                const r = 15 + Math.random() * 20;
                circle.setAttribute("cx", x);
                circle.setAttribute("cy", 20);
                circle.setAttribute("r", r);
                circle.setAttribute("class", "slime-drop");
                circle.style.animationDelay = (Math.random() * 2) + "s";
                circle.style.animationDuration = (2 + Math.random() * 2) + "s";
                svg.appendChild(circle);
                
                // Base do slime para conectar as gotas
                const base = document.createElementNS(svgNS, "rect");
                base.setAttribute("x", 0);
                base.setAttribute("y", 0);
                base.setAttribute("width", "100%");
                base.setAttribute("height", "30");
                base.setAttribute("fill", "#CCFF00");
                svg.appendChild(base);
            }
            return svg;
        }

        function addMessage(user, message) {
            const wrapper = document.createElement('div');
            wrapper.className = 'message-wrapper wobble';

            const block = document.createElement('div');
            block.className = 'message-block';

            const nameEl = document.createElement('span');
            nameEl.className = 'username';
            nameEl.innerText = user;

            const textEl = document.createElement('span');
            textEl.className = 'text';
            textEl.innerText = message;

            block.appendChild(nameEl);
            block.appendChild(textEl);
            wrapper.appendChild(block);

            // Adiciona o container de Slime
            const slimeCont = document.createElement('div');
            slimeCont.className = 'slime-container';
            slimeCont.appendChild(createSlimeSVG());
            wrapper.appendChild(slimeCont);

            chatContainer.appendChild(wrapper);

            // Remover mensagens antigas
            const messages = document.querySelectorAll('.message-wrapper');
            if (messages.length > MAX_MESSAGES) {
                const toRemove = messages[0];
                toRemove.style.animation = "exit 0.5s forwards";
                setTimeout(() => toRemove.remove(), 500);
            }
        }

        // Conectando à Twitch
        function initTwitch() {
            if (typeof tmi === 'undefined') {
                setTimeout(initTwitch, 1000);
                return;
            }

            const client = new tmi.Client({
                connection: { secure: true, reconnect: true },
                channels: [TWITCH_CHANNEL]
            });

            client.connect().then(() => {
                console.log("Conectado ao chat de " + TWITCH_CHANNEL);
                // Mensagem inicial para teste visual
                addMessage("SISTEMA", "Overlay Candy Y2K carregado!");
            }).catch(console.error);

            client.on('message', (channel, tags, message, self) => {
                if (self) return;
                const user = tags['display-name'] || tags.username;
                addMessage(user, message);
            });
        }

        // Teste manual ao clicar
        window.addEventListener('mousedown', () => {
            addMessage("TESTE", "Esta é uma mensagem de teste 2.5D super saturada!");
        });

        window.onload = initTwitch;
    </script>

    <style>
        @keyframes exit {
            to { transform: translateY(-100px) scale(0.8); opacity: 0; }
        }
    </style>
</body>
</html>
