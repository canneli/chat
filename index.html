<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Felipe Canneli - Only 3D Acid Lettering & Twitch Chat</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Archivo+Black&display=swap');

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: transparent !important; 
            font-family: 'Archivo Black', sans-serif;
        }

        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
        }

        /* Filtro de Saturação Y2K */
        .hyper-filter {
            position: fixed;
            inset: 0;
            pointer-events: none;
            backdrop-filter: saturate(2) contrast(1.2);
            z-index: 5;
        }

        /* Chat Container */
        #chat-container {
            position: fixed;
            bottom: 40px;
            left: 30px;
            width: 380px;
            height: 60vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            z-index: 10;
            pointer-events: none;
            mask-image: linear-gradient(to top, black 85%, transparent 100%);
        }

        .chat-message {
            background: rgba(0, 0, 0, 0.9);
            border: 4px solid #39ff14; /* Verde Slime */
            padding: 12px;
            margin-bottom: 15px;
            color: white;
            animation: slideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            box-shadow: 8px 8px 0px #ff4500; /* Sombra Laranja Nick */
            position: relative;
        }

        /* Detalhe de brilho no topo da mensagem */
        .chat-message::after {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 2px;
            background: #ffffff;
            opacity: 0.5;
        }

        .user-name {
            color: #39ff14;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
            display: block;
            text-shadow: 2px 2px 0px #000;
        }

        .message-text {
            font-size: 18px;
            line-height: 1.3;
            word-wrap: break-word;
            text-shadow: 2px 2px 0px #000;
        }

        @keyframes slideIn {
            from { 
                transform: translateX(-120%) skewX(-15deg); 
                opacity: 0; 
            }
            to { 
                transform: translateX(0) skewX(0); 
                opacity: 1; 
            }
        }

        .fade-out {
            animation: fadeOut 0.6s forwards;
        }

        @keyframes fadeOut {
            to { 
                opacity: 0; 
                transform: translateX(-50px) scale(0.8); 
                filter: blur(10px);
            }
        }

        /* Indicador de Status do Chat */
        #chat-status {
            position: fixed;
            bottom: 10px;
            left: 30px;
            font-size: 10px;
            color: #39ff14;
            text-transform: uppercase;
            z-index: 11;
            letter-spacing: 2px;
            opacity: 0.6;
        }
    </style>
</head>
<body>

    <canvas id="bg-canvas"></canvas>
    <div id="chat-container"></div>
    <div id="chat-status">SISTEMA ONLINE // FELIPECANNELI</div>
    <div class="hyper-filter"></div>

    <script>
        let scene, camera, renderer, clock;
        
        // Configurações do Lettering 3D
        let textBlock, textTexture, textCanvas, textContext;
        let phraseIndex = 0;
        
        const phrases = [
            "SILÊNCIO, O ARTISTA ESTÁ EXAUSTO",
            "FUI BUSCAR O BANHEIRO, JÁ VOLTO",
            "FUI USAR A PIPOCA",
            "BUSCANDO PACIÊNCIA (ESTÁ ESGOTADA)",
            "SAÍ PRA VER SE EU TAVA NA ESQUINA",
            "CARREGANDO MAIS UM ERRO NA VIDA",
            "O CÉREBRO FOI COMER E NÃO VOLTOU",
            "PROCESSANDO MINHA FALTA DE TALENTO",
            "EM BUSCA DA DIGNIDADE PERDIDA",
            "FUI ALI ME CANCELAR E JÁ VOLTO"
        ];
        let lastPhraseChange = 0;

        // TWITCH CHAT CONFIG
        const channel = 'felipecanneli';
        const chatContainer = document.getElementById('chat-container');

        function connectTwitchChat() {
            const socket = new WebSocket('wss://irc-ws.chat.twitch.tv:443');

            socket.onopen = () => {
                socket.send('PASS SCHMOOPIIE');
                socket.send('NICK justinfan' + Math.floor(Math.random() * 10000));
                socket.send('JOIN #' + channel);
                
                // Mensagens de Boas-vindas para teste visual
                setTimeout(() => addChatMessage("SISTEMA", "CONEXÃO ESTABELECIDA COM SUCESSO."), 500);
                setTimeout(() => addChatMessage("FELIPE", "CHAT ACID MODO ON. DIGITA AÍ."), 1500);
            };

            socket.onmessage = (event) => {
                const message = event.data;
                if (message.includes('PRIVMSG')) {
                    const parts = message.split('PRIVMSG #' + channel + ' :');
                    const userPart = message.split('!')[0];
                    const displayName = userPart.substring(1);
                    const chatMsg = parts[1];
                    addChatMessage(displayName, chatMsg);
                }
                if (message.includes('PING :tmi.twitch.tv')) {
                    socket.send('PONG :tmi.twitch.tv');
                }
            };

            socket.onclose = () => {
                console.log("Chat fechado. Reconectando...");
                setTimeout(connectTwitchChat, 3000);
            };
        }

        function addChatMessage(user, message) {
            const msgDiv = document.createElement('div');
            msgDiv.className = 'chat-message';
            msgDiv.innerHTML = `
                <span class="user-name">${user}</span>
                <span class="message-text">${message}</span>
            `;
            
            chatContainer.appendChild(msgDiv);

            // Mantém as últimas 7 mensagens
            if (chatContainer.childNodes.length > 7) {
                chatContainer.removeChild(chatContainer.firstChild);
            }

            // Desaparece após 20 segundos
            setTimeout(() => {
                msgDiv.classList.add('fade-out');
                setTimeout(() => {
                    if (msgDiv.parentNode) msgDiv.remove();
                }, 600);
            }, 20000);
        }

        function init() {
            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 85);

            renderer = new THREE.WebGLRenderer({ 
                canvas: document.getElementById('bg-canvas'), 
                antialias: true,
                alpha: true 
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setClearColor(0x000000, 0); 
            
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.toneMappingExposure = 1.6; 

            clock = new THREE.Clock();

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.9);
            scene.add(ambientLight);

            const keyLight = new THREE.DirectionalLight(0xffffff, 1.8);
            keyLight.position.set(20, 50, 50);
            scene.add(keyLight);

            const rimLight = new THREE.PointLight(0x39ff14, 25, 120);
            rimLight.position.set(-40, 30, 30);
            scene.add(rimLight);

            create3DLettering();
            connectTwitchChat();

            window.addEventListener('resize', onWindowResize);
            animate();
        }

        function create3DLettering() {
            textCanvas = document.createElement('canvas');
            textCanvas.width = 1024;
            textCanvas.height = 256;
            textContext = textCanvas.getContext('2d');
            
            textTexture = new THREE.CanvasTexture(textCanvas);
            
            const geometry = new THREE.BoxGeometry(65, 15, 8);
            
            const chromeMat = new THREE.MeshStandardMaterial({ 
                color: 0xffffff, 
                metalness: 1, 
                roughness: 0.05,
                emissive: 0x39ff14,
                emissiveIntensity: 0.08
            });
            
            const faceMat = new THREE.MeshStandardMaterial({ 
                map: textTexture, 
                transparent: true,
                metalness: 0.1,
                roughness: 0.2
            });
            
            const materials = [
                chromeMat, chromeMat, chromeMat, chromeMat, faceMat, faceMat
            ];
            
            textBlock = new THREE.Mesh(geometry, materials);
            scene.add(textBlock);
            
            updateLettering(phrases[0]);
        }

        function updateLettering(text) {
            const ctx = textContext;
            ctx.clearRect(0, 0, 1024, 256);
            
            ctx.fillStyle = '#39ff14'; 
            ctx.beginPath();
            ctx.roundRect(10, 10, 1004, 236, 60);
            ctx.fill();
            
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 25;
            ctx.stroke();

            ctx.strokeStyle = '#ffffff';
            ctx.lineWidth = 8;
            ctx.stroke();
            
            ctx.fillStyle = '#000000';
            ctx.font = '900 44px "Arial Black", sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            ctx.shadowColor = '#ff4500'; 
            ctx.shadowBlur = 0;
            ctx.shadowOffsetX = 8;
            ctx.shadowOffsetY = 8;
            
            ctx.fillText(text, 512, 128);
            
            textTexture.needsUpdate = true;
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();

            if (time - lastPhraseChange > 6) {
                phraseIndex = (phraseIndex + 1) % phrases.length;
                updateLettering(phrases[phraseIndex]);
                lastPhraseChange = time;
            }
            
            if (textBlock) {
                textBlock.rotation.y = Math.sin(time * 0.4) * 0.3;
                textBlock.rotation.x = Math.cos(time * 0.3) * 0.12;
                textBlock.position.y = Math.sin(time * 1.4) * 5;
            }

            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        window.onload = init;
    </script>
</body>
</html>
